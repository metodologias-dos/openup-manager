<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:OpenUpMan.UI.ViewModels"
        x:Class="OpenUpMan.UI.Views.ProjectsPopup"
        x:DataType="vm:ProjectsPopupViewModel"
        Width="1000" Height="600"
        MinWidth="800" MinHeight="500"
        Icon="/Assets/avalonia-logo.ico"
        Title="Gestor de Proyectos - OpenUpMan">

  <Window.Styles>
    <!-- Estilo para las filas de proyectos con hover -->
    <Style Selector="Border.project-row">
      <Setter Property="Background" Value="Transparent" />
      <Setter Property="BorderBrush" Value="{DynamicResource SystemControlForegroundBaseMediumLowBrush}" />
      <Setter Property="BorderThickness" Value="0,0,0,1" />
      <Setter Property="Padding" Value="16,12" />
      <Setter Property="Margin" Value="0" />
      <Setter Property="CornerRadius" Value="6" />
      <Setter Property="Transitions">
        <Transitions>
          <BrushTransition Property="Background" Duration="0:0:0.15" />
        </Transitions>
      </Setter>
    </Style>
    <Style Selector="Border.project-row:pointerover">
      <Setter Property="Background" Value="{DynamicResource SystemControlHighlightListLowBrush}" />
    </Style>

    <!-- Estilo para botones pequeños de acción -->
    <Style Selector="Button.action-button">
      <Setter Property="Padding" Value="12,6" />
      <Setter Property="Margin" Value="4,0" />
      <Setter Property="FontSize" Value="13" />
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="Cursor" Value="Hand" />
    </Style>

    <!-- Estilo para el header de columnas -->
    <Style Selector="TextBlock.column-header">
      <Setter Property="FontWeight" Value="Bold" />
      <Setter Property="FontSize" Value="13" />
      <Setter Property="Foreground" Value="{DynamicResource TextControlForeground}" />
      <Setter Property="Opacity" Value="0.8" />
      <Setter Property="Margin" Value="0,0,0,8" />
    </Style>
  </Window.Styles>

  <Grid RowDefinitions="Auto,*" Margin="24">
    <!-- Header Section -->
    <Border Grid.Row="0" Padding="0,0,0,24">
      <Grid ColumnDefinitions="*,Auto">
        <!-- Title -->
        <StackPanel Grid.Column="0" Spacing="4">
          <TextBlock Text="Mis Proyectos" FontSize="28" FontWeight="Bold" />
          <TextBlock Text="Gestiona y organiza tus proyectos" 
                     FontSize="14" 
                     Opacity="0.7" />
        </StackPanel>

        <!-- Action Buttons -->
        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
          <Button Command="{Binding NewProjectCommand}" 
                  Classes="primary"
                  Padding="16,10"
                  FontSize="14">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <TextBlock Text="+" FontSize="16" FontWeight="Bold" VerticalAlignment="Center" />
              <TextBlock Text="Nuevo Proyecto" VerticalAlignment="Center" />
            </StackPanel>
          </Button>
          <Button Content="Cerrar sesión" 
                  Command="{Binding LogoutCommand}"
                  Padding="16,10"
                  FontSize="14" />
        </StackPanel>
      </Grid>
    </Border>

    <!-- Projects List Section -->
    <Border Grid.Row="1" 
            Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
            BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
            BorderThickness="1"
            CornerRadius="8"
            Padding="0">
      
      <Grid RowDefinitions="Auto,*">
        <!-- Column Headers -->
        <Border Grid.Row="0" 
                Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                BorderThickness="0,0,0,2"
                Padding="16,12">
          <Grid ColumnDefinitions="3*,1.5*,2*,Auto,Auto">
            <TextBlock Grid.Column="0" Text="NOMBRE DEL PROYECTO" Classes="column-header" />
            <TextBlock Grid.Column="1" Text="ID" Classes="column-header" HorizontalAlignment="Center" />
            <TextBlock Grid.Column="2" Text="ÚLTIMA EDICIÓN" Classes="column-header" HorizontalAlignment="Center" />
            <TextBlock Grid.Column="3" Text="ACCIONES" Classes="column-header" HorizontalAlignment="Center" Margin="0,0,80,8" />
          </Grid>
        </Border>

        <!-- Projects List with Scroll -->
        <ScrollViewer Grid.Row="1"
                      HorizontalScrollBarVisibility="Disabled" 
                      VerticalScrollBarVisibility="Auto"
                      Padding="0"
                      IsVisible="{Binding !IsLoadingProjects}">
          <ItemsControl ItemsSource="{Binding Projects}" Margin="0">
            <ItemsControl.ItemTemplate>
              <DataTemplate DataType="vm:ProjectListItemViewModel">
                <Border Classes="project-row">
                  <Grid ColumnDefinitions="3*,1.5*,2*,Auto,Auto">
                    <!-- Nombre con icono -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                      <Border Background="{DynamicResource SystemAccentColor}"
                              Width="40" Height="40"
                              CornerRadius="6"
                              VerticalAlignment="Center">
                        <Viewbox Width="20" Height="20">
                          <Canvas Width="24" Height="24">
                            <Path Fill="White" Data="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/>
                          </Canvas>
                        </Viewbox>
                      </Border>
                      <TextBlock Text="{Binding Name}" 
                                 VerticalAlignment="Center" 
                                 FontSize="15"
                                 FontWeight="Medium" />
                    </StackPanel>

                    <!-- ID -->
                    <TextBlock Grid.Column="1" 
                               Text="{Binding Id}" 
                               VerticalAlignment="Center" 
                               HorizontalAlignment="Center"
                               FontSize="13"
                               Opacity="0.7"
                               FontFamily="Consolas, Courier New" />

                    <!-- Fecha -->
                    <TextBlock Grid.Column="2" 
                               Text="{Binding LastEdited}" 
                               VerticalAlignment="Center" 
                               HorizontalAlignment="Center"
                               FontSize="13"
                               Opacity="0.8" />

                    <!-- Botón Abrir -->
                    <Button Grid.Column="3" 
                            Command="{Binding $parent[Window].((vm:ProjectsPopupViewModel)DataContext).OpenProjectCommand}" 
                            CommandParameter="{Binding}"
                            Classes="primary action-button">
                      <StackPanel Orientation="Horizontal" Spacing="6">
                        <Viewbox Width="14" Height="14">
                          <Canvas Width="24" Height="24">
                            <Path Fill="White" Data="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/>
                          </Canvas>
                        </Viewbox>
                        <TextBlock Text="Abrir" VerticalAlignment="Center" />
                      </StackPanel>
                    </Button>

                    <!-- Botón Borrar -->
                    <Button Grid.Column="4" 
                            Command="{Binding $parent[Window].((vm:ProjectsPopupViewModel)DataContext).DeleteProjectCommand}" 
                            CommandParameter="{Binding}"
                            Classes="action-button"
                            Background="#E81123"
                            Foreground="White">
                      <StackPanel Orientation="Horizontal" Spacing="6">
                        <Viewbox Width="14" Height="14">
                          <Canvas Width="24" Height="24">
                            <Path Fill="White" Data="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                          </Canvas>
                        </Viewbox>
                        <TextBlock Text="Borrar" VerticalAlignment="Center" />
                      </StackPanel>
                      <Button.Styles>
                        <Style Selector="Button:pointerover">
                          <Setter Property="Background" Value="#D0101F" />
                        </Style>
                        <Style Selector="Button:pressed">
                          <Setter Property="Background" Value="#B80D1A" />
                        </Style>
                      </Button.Styles>
                    </Button>
                  </Grid>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </ScrollViewer>
        
        <!-- Overlay de carga -->
        <Border Grid.Row="1"
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                IsVisible="{Binding IsLoadingProjects}">
          <StackPanel HorizontalAlignment="Center" 
                      VerticalAlignment="Center" 
                      Spacing="16">
            <!-- Spinner de carga simple -->
            <ProgressBar IsIndeterminate="True" 
                         Width="100" 
                         Height="6"
                         HorizontalAlignment="Center" />
            <TextBlock Text="{Binding LoadingMessage}" 
                       FontSize="16" 
                       HorizontalAlignment="Center"
                       Opacity="0.8" />
          </StackPanel>
        </Border>
      </Grid>
    </Border>
  </Grid>

</Window>
